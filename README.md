# Local PC Monitor — README

This workspace contains a small local monitoring tool that samples CPU, memory, disk and network statistics and exposes a lightweight dashboard.

Quick file map
- [dashboard.html](dashboard.html) — browser dashboard UI (generated by the monitor).
  - Key JS symbols: [`fetchLines`](dashboard.html), [`applyFilter`](dashboard.html), [`renderChart`](dashboard.html), [`parseLine`](dashboard.html)
- [monitor_data.jsonl](monitor_data.jsonl) — newline-delimited JSON samples (one JSON object per line).
- [monitor.ps1](monitor.ps1) — sampler that appends samples, trims file and regenerates the dashboard.
  - Key PowerShell variables: [`$DataFile`](monitor.ps1), [`$HtmlFile`](monitor.ps1), [`$Interval`](monitor.ps1), [`$Keep`](monitor.ps1)
- [serve.ps1](serve.ps1) — minimal static HTTP server using HttpListener.  
  - Key symbol: [`Get-MimeType`](serve.ps1)
- [monitor.bat](monitor.bat) — simple menu wrapper to start/stop the monitor and open the dashboard in the browser.

Requirements
- Windows with PowerShell (built-in). No external packages required.
- To view the dashboard reliably use the local server (avoid opening the file over file://). The bundle includes [serve.ps1](serve.ps1) and [monitor.bat](monitor.bat) will start it for you.

How to run
1. Open a command prompt in the workspace directory (or double-click `monitor.bat`).
2. Start sampling: choose option `1) Start monitoring (background)` in [monitor.bat](monitor.bat). This starts [monitor.ps1](monitor.ps1) which writes to [monitor_data.jsonl](monitor_data.jsonl) and regenerates [dashboard.html](dashboard.html).
3. View dashboard: choose option `3) Open HTML view` in [monitor.bat](monitor.bat). This starts [serve.ps1](serve.ps1) (if needed) and opens http://127.0.0.1:8000/dashboard.html in your default browser.

Common issues and troubleshooting
- Dashboard shows "No data" or empty charts:
  - Ensure you opened the dashboard via the local server (option 3) — browsers may block fetch() from file://.
  - Check the browser DevTools Console for JavaScript errors; they point to the exact failing function (see [`fetchLines`](dashboard.html), [`applyFilter`](dashboard.html)).
  - Remove any non-JSON header lines in [monitor_data.jsonl](monitor_data.jsonl). The file must contain one JSON object per line. To remove comment lines in PowerShell:
    ```powershell
    (Get-Content .\monitor_data.jsonl) | Where-Object { -not ($_ -match '^\s*//') } | Set-Content .\monitor_data.jsonl
    ```
- Timestamps and filtering:
  - The sampler writes timestamps in format `yyyy-MM-dd HH:mm:ss`. Some browsers do not reliably parse that format with `new Date(...)`. If filtering returns no results, check the console and consider normalizing timestamp strings to ISO format (`YYYY-MM-DDTHH:mm:ss`) in the dashboard JS before parsing (see [`applyFilter`](dashboard.html) and [`parseLine`](dashboard.html)).
- PID display and "Kill monitor" button:
  - The current [serve.ps1](serve.ps1) is a static server and does not implement `/pid` or `/kill` endpoints. The dashboard may show `??` for the monitor PID and kill will not work until the server is extended. See [`Get-MimeType`](serve.ps1) for the serving logic.
- Dashboard not updating:
  - Confirm [monitor.ps1](monitor.ps1) is running (option 1). Restart the monitor if needed (use option 2 to stop then option 1 to start).
  - Hard-refresh the browser (Ctrl+F5) to clear cached JS.

Notes for maintenance
- The sampler trims [monitor_data.jsonl](monitor_data.jsonl) to the last `$Keep` samples; change [`$Keep`](monitor.ps1) to retain more or fewer samples.
- The dashboard is generated from a single template inside [monitor.ps1](monitor.ps1) and written to [dashboard.html](dashboard.html). If you modify the template inside `monitor.ps1` restart the monitor for the regenerated file to take effect.
- If you need the server to support dynamic actions (PID, kill), extend [serve.ps1](serve.ps1) to handle the `/pid` and `/kill` routes and return appropriate responses.

If you want, I can:
- Produce a small patch to remove the leading comment line in `monitor_data.jsonl` generation so the file contains only valid JSONL lines.
- Add `/pid` and `/kill` endpoints to [serve.ps1](serve.ps1).